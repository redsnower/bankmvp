<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>BankMVP</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="container">
    <h1>BankMVP ✅</h1>
    <section id="accounts-section">
      <h2>Accounts</h2>
      <ul id="accounts-list"></ul>
      <button id="refresh">Refresh</button>
    </section>

    <section id="transfer-section">
      <h2>Transfer</h2>
      <form id="transfer-form">
        <label>From
          <select id="from"></select>
        </label>
        <label>To
          <select id="to"></select>
        </label>
        <label>Amount
          <input id="amount" type="number" min="1" step="0.01" required />
        </label>
        <button type="submit">Send</button>
      </form>
      <div id="msg"></div>
    </section>
  </div>

<script>
async function fetchAccounts(){
  const res = await fetch('/api/accounts');
  return res.json();
}

function renderAccounts(list){
  const ul = document.getElementById('accounts-list');
  ul.innerHTML = '';
  list.forEach(acc => {
    const li = document.createElement('li');
    li.textContent = `${acc.id} — ${acc.name}: $${acc.balance.toFixed(2)}`;
    ul.appendChild(li);
  });

  const from = document.getElementById('from');
  const to = document.getElementById('to');
  from.innerHTML = '';
  to.innerHTML = '';
  list.forEach(acc => {
    const o1 = document.createElement('option'); o1.value = acc.id; o1.textContent = `${acc.id} - ${acc.name}`;
    const o2 = document.createElement('option'); o2.value = acc.id; o2.textContent = `${acc.id} - ${acc.name}`;
    from.appendChild(o1); to.appendChild(o2);
  });
}

async function refresh(){
  const list = await fetchAccounts();
  renderAccounts(list);
}

window.addEventListener('load', () => {
  refresh();
  document.getElementById('refresh').addEventListener('click', refresh);
  document.getElementById('transfer-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const from = document.getElementById('from').value;
    const to = document.getElementById('to').value;
    const amount = parseFloat(document.getElementById('amount').value);
    const msg = document.getElementById('msg');
    msg.textContent = '';
    const res = await fetch('/api/transfer', {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ from, to, amount })
    });
    const data = await res.json();
    if(!res.ok) msg.textContent = 'Error: ' + (data.error || 'unknown');
    else { msg.textContent = 'Success!'; await refresh(); }
  });
});
</script>
</body>
</html>